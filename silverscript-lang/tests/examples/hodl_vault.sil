pragma silverscript ^0.1.0;

contract HodlVault(
    pubkey ownerPk,
    pubkey oraclePk,
    int minBlock,
    int priceTarget
) {
    entrypoint function spend(sig ownerSig, datasig oracleSig, byte[] oracleMessage) {
        byte[4] blockHeightBin, byte[4] priceBin = oracleMessage.split(4);
        int blockHeight = int(blockHeightBin);
        int price = int(priceBin);

        require(blockHeight >= minBlock);
        require(tx.time >= blockHeight);
        require(price >= priceTarget);

        require(checkDataSig(oracleSig, oracleMessage, oraclePk));
        require(checkSig(ownerSig, ownerPk));
    }
}
